{% extends "master.html" %} {% block title %} È¶ôÊ∏ØÈõªËÖ¶Ê®°ÂûãË≥ΩÈ¶¨È†êÊ∏¨ {% endblock %} 

{% load i18n %}
{% load static %}

{% block content %}


<script>
  function updateSelection(checkbox) {
      var selectedCheckboxes = document.querySelectorAll('input[name="selected_horses"]:checked');

      if (selectedCheckboxes.length > 3) {
          checkbox.checked = false; // Uncheck the current checkbox if more than 3 are selected
      }

      // Disable unchecked checkboxes if 3 are selected
      var uncheckedCheckboxes = document.querySelectorAll('input[name="selected_horses"]:not(:checked)');
      uncheckedCheckboxes.forEach(function (uncheckedCheckbox) {
          uncheckedCheckbox.disabled = selectedCheckboxes.length >= 3;
      });
  }
</script>

<div class="w3-container w3-padding-32"></div>
<div class="w3-margin ">
  
    <h2><img src="{% static 'HKFlag.png' %}" alt="Hong Kong" style="width:4%"> &nbsp; {% trans "Current Race"  %} {{ current_race.iloc.2.1}} </h2>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '1' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=1">1</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '2' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=2">2</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '3' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=3">3</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '4' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=4">4</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '5' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=5">5</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '6' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=6">6</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '7' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=7">7</a>
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '8' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=8">8</a>
        {% if current_race.iloc.2.8 > 8 %}
          <a class="w3-button w3-large w3-circle {% if request.GET.id == '9' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=9">9</a>
          {% if current_race.iloc.2.8 > 9 %}
            <a class="w3-button w3-large w3-circle {% if request.GET.id == '10' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=10">10</a>
            {% if current_race.iloc.2.8 > 10 %}
              <a class="w3-button w3-large w3-circle {% if request.GET.id == '11' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=11">11</a>
            {% endif %}
          {% endif %}
        {% endif %}
  </div>

 
<div class="w3-row">
  <div class="w3-col w3-padding-top-32 l6 s12">
    
    <table class="w3-table-all w3-card-4 w3-margin">
      <span class="w3-tag w3-right w3-grey">Â£ûÂç¶</span><span class="w3-tag w3-right w3-yellow">Â•ΩÂç¶</span>
      <thead>
        <tr class="w3-light-blue">
          <th>No</th>
          <th>{% trans "Horse Name" %}</th>
          <th class="w3-hide-small">{% trans "Jockey" %}</th>
          <th>{% trans 'Vote' %}</th>
          <th>Âç¶Ë±°</th>
        </tr>
      </thead>
      {% for i, r in current_race.iterrows %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{% trans r.HorseName %} </td>
        <td class="w3-hide-small">{% trans r.Jockey %}</td>
        <td>
          
          {% with horse_name=r.HorseName %}
          {% for vote in horse_tips_qty %}
          {% if vote.horse_name == horse_name %}
              {% if vote.user__groups__name == "MailList" %}
                {% cycle 'w3-green' as color silent %}
                {% cycle 'fa-person' as icon silent %}
              {% else %}
                {% cycle 'w3-blue' as color silent %}
                {% cycle 'fa-robot' as icon silent %}
              {% endif %}
          <div class="w3-light-grey">
            <div class="{{ color }} w3-center w3-round" style="height: 20px; width:{{ vote.num_tips }}0px; display: inline-block;">{{ vote.num_tips }}</div>
            <i class="fa-solid {{icon}}" style="display: inline-block; width: 16px;"></i>
          </div>
          {% endif %}
          {% endfor %}
          {% endwith %}
      </td>
      <td class="w3-center {% if r.Ichi == 1 or r.Ichi == 2 or r.Ichi == 34 or r.Ichi == 11  or r.Ichi == 13 or r.Ichi == 14 or r.Ichi == 50 or r.Ichi == 35 or r.Ichi == 9 %} w3-yellow {% endif %} {% if r.Ichi == 23 or r.Ichi == 44 or r.Ichi == 21 or r.Ichi == 18  or r.Ichi == 59 %} w3-grey {% endif %}">
        <img src="/static/Iching-{{ r.Ichi }}.png" width="20">
    </td>
      {% endfor %}
    </table>
   
  <div class="w3-center w3-xlarge">
  {% if user.is_authenticated %}
    <button id='myButton' onclick="document.getElementById('id01').style.display='block'" class="w3-button w3-ripple w3-red" >+</button>&nbsp<span id="msg001"> <i class="fa-regular fa-hand-point-left fa-xl"></i>&nbsp{% trans "Add Your Tips" %}</span>
  {% else %}
    <button id='myButton' onclick="document.getElementById('id02').style.display='block'" class="w3-button w3-ripple w3-red" >+</button>&nbsp<span id="msg001"><i class="fa-regular fa-hand-point-left fa-xl"></i>&nbsp{% trans "Add Your Tips" %} </span>
  {% endif %}
  </div>

  <div class="w3-card w3-margin">
    <div class="w3-container w3-padding">
      <h4>{% trans 'Recent Posts' %}</h4>
    </div>
    <ul class="w3-ul w3-hoverable w3-white">
      <ul>
        {% for article in recent_articles %}
        <li><a href="../blog/?id={{ forloop.counter }}">{{ article.title }}</a></li>
        {% endfor %}
    </ul>
  </div>

</div>
    

<!-- This Part shows the User Tips rank by the most updated Current Race Performance -->
  <div class="w3-col w3-padding-top-32 l6 s12" >
        <div class="w3-margin">
        <a href="/view_by_member" class="w3-button w3-black"><i class="fa-solid fa-circle-arrow-right"></i>&nbsp {% trans 'Tips Summary' %}</a> 
        
        <a href="https://ragnolopi.net/4/7158525" class="w3-button w3-black"><i class="fa-solid fa-solid fa-heart fa-beat" style="color: #f01000;"></i>&nbsp {% trans 'Support MK' %}</a>
        <a href="{% url 'match_chart' %}?id={{ race_id }}" class="w3-button w3-black"><i class="fa-solid fa-chess-knight"></i>&nbsp {% trans 'Battle Chart' %}</a>&nbsp 
        <br><br>
        &nbsp &nbsp <i class="fa-solid fa-person fa-xl"></i>&nbsp  {% trans 'Human'%} &nbsp 
        {% for item in tips_qty_by_type %}
            {% if item.user__groups__name == 'MailList' %}
                    <span class="w3-badge w3-green"> {{ item.num_users }} </span>
            {% endif %}
        {% endfor %}
              
                     |&nbsp
          <i class="fa-solid fa-robot fa-xl"></i>&nbsp {% trans 'Robot'%} &nbsp; 
          {% for item in tips_qty_by_type %}
          {% if item.user__groups__name != 'MailList' %}
          <span class="w3-badge w3-blue"> {{ item.num_users }}</span>
          {% endif %}
          {% endfor %}

      </div>
        <div class="w3-row-padding">
        
        {% for user_data in complete_tips_by_user %} <!-- Loop over the zipped data -->
          {% cycle 'w3-blue' 'w3-green' 'w3-yellow' 'w3-brown' 'w3-indigo' 'w3-lime' 'w3-pale-blue' as color silent %}
              <div class="w3-col w3-card-4 w3-third w3-margin-left w3-margin-bottom l3 m5 s5 w3-left-align">
                
                <header class="w3-container {{color}}" >
                  <h6>{{ user_data.user  }}
                    {% if forloop.counter == 1 %}
                        <span class="w3-right"><i class="fa-solid fa-crown fa-rotate-by" style="color: #FFD43B; --fa-rotate-angle: 15deg;""></i></span>
                    {% elif forloop.counter == 2 %}
                    <span class="w3-right"><i class="fa-solid fa-crown fa-rotate-by" style="color: #f6f5f1e9; --fa-rotate-angle: 15deg;""></i></span>
                    {% endif %}<br>
                    {% for score in user_scores %}
                    {% if score.user == user_data.user %}
                      {% if score.stars %}
                          {% for star in score.stars %}
                            {% if star == '1' %}
                              <i class="fa-solid fa-star fa-sm" style="color: #FBB337;"></i>
                            {% else %}
                              <i class="fa-solid fa-medal fa-lg" style="color: #FBB337;"></i>
                            {% endif %}
                          {% endfor %}
                      {% else %}
                          -
                      {% endif %}
                    {% endif %}
                    {% endfor %}</h6>
                  </header>
                      {% for user_tips in user_data.records %}
                              <p><span class="w3-badge">{{ user_tips.horse_no }}</span>&nbsp {% trans user_tips.horse_name %} {% if user_tips.hit == 1 %}
                                <span class="w3-badge w3-red w3-small">${{user_tips.dividend}}</span>
                              {% endif %}
                              </p>
                              <!-- Add more details as needed -->
                      {% endfor %}
                      <footer class="w3-container {{color}} w3-left-align">
                        <span class="w3-small">
                          <p class="w3-left-align">
                            {% trans 'Current' %}:
                            {% for last_perf in last_perf_by_user %}
                              {% if last_perf.user__username  == user_data.user.username %}
                                <span class ="w3-tooltip w3-red">{{ last_perf.hit_pst | floatformat:0 }}% 
                                <span class="w3-text">(<em>üí∞${{ last_perf.total_dividend | floatformat:0 }}</em>)</span></span>
                              {% endif %}
                            {% endfor %}
                            <br>
                            {% trans 'Total' %}:
                            {% for score in user_scores %}
                                {% if score.user == user_data.user %}
                                    {{ score.percentage | floatformat:0 }}%
                                {% endif %}
                            {% endfor %}
                            <span class = "w3-right">
                            {% if user_data.groups_name == "MailList" %}
                              <i class="fa-solid fa-person fa-xl "></i>
                            {% elif user_data.user.username == 'WePower' %}
                                <i class="fa-solid fa-users-gear fa-xl"></i>
                            {% else %}
                              <i class="fa-solid fa-robot"></i>
                            {% endif %} </span>
                          </p> 
                      </span>
                      </footer>
              </div>
          {% endfor %}
      </div>



     <div class="w3-container w3-padding-16 w3-margin-left">
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '1' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=1">1</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '2' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=2">2</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '3' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=3">3</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '4' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=4">4</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '5' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=5">5</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '6' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=6">6</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '7' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=7">7</a>
    <a class="w3-button w3-large w3-circle {% if request.GET.id == '8' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=8">8</a>
    {% if current_race.iloc.2.8 > 8 %}
      <a class="w3-button w3-large w3-circle {% if request.GET.id == '9' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=9">9</a>
      {% if current_race.iloc.2.8 > 9 %}
        <a class="w3-button w3-large w3-circle {% if request.GET.id == '10' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=10">10</a>
        {% if current_race.iloc.2.8 > 10 %}
          <a class="w3-button w3-large w3-circle {% if request.GET.id == '11' %}w3-red{% else %}w3-black{% endif %}" href="/racecard/?id=11">11</a>
        {% endif %}
      {% endif %}
    {% endif %}
    </div>
    <div class="w3-center">
      <a href="https://ragnolopi.net/4/7158525" class="w3-button w3-large"><i class="fa-solid fa-circle-arrow-right fa-xl" style="color: #f01000;"></i>&nbsp {% trans "Support Monkey" %}</a>
        </button>
        </div>
      <div class="w3-panel w3-card-4 w3-light-grey" style="width:90%">
          <p class=" w3-large w3-serif">
        <i class="fa fa-quote-right w3-xxlarge w3-text-red"></i><br>
        MonkeyÊØèÊúüÈñãË≥ΩÂâçÔºåMonkeyÊúÉÊõ¥Êñ∞ÈõªËÖ¶Á®ãÂºèÁöÑË≥ΩÈ¶¨‰ΩçÁΩÆÈ†êÊ∏¨„ÄÇÂêåÊôÇ‰πüÊúÉÈñãÊîæÂπ≥Âè∞Áµ¶ÊúÉÂì°ÂàÜ‰∫´ÂøÉÊ∞¥ÔºåÂ∏åÊúõÈÄöÈÅéÂàÜ‰∫´ÔºåÂ§ßÂÆ∂ÂèØ‰ª•ÊúâÊ∫ñÁ¢∫ÁöÑÊäïÊ≥®„ÄÇÊàëÁöÑYouTube VideoÊúâË©≥Á¥∞‰ªãÁ¥π <a href="https://youtu.be/bK_yWVwjz48"><i class="fa-brands fa-youtube fa-xl" style="color: #f10909;"></i></a></p>
      </div>
       <!-- Add Tips by users-->

        <div id="id01" class="w3-modal">
          <div class="w3-modal-content">
              <div class="w3-center w3-xlarge w3-blue"><i class="fa fa-spinner fa-spin fa-lg fa-fw" aria-hidden="true"></i>
                <span onclick="closeAddTipsFormModal()" class="w3-button w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
                   Race {{race_id}} Tips {{ current_race.iloc.2.1}}
              </div>
  
          <form method="post" action="{% url 'submit_tips' %}" class="w3-container w3-margin-left">
            {% csrf_token %}
            <input type="hidden" name="race_no" value="{{ race_id }}">
            <input type="hidden" name="race_date" value="{{current_race.iloc.2.1}}"> <!-- Update with the desired date -->
            <h4>{% trans 'Select up to 3 horses' %}:</h4>
            {% for i, r in current_race.iterrows %}
                <label>
                    <input type="checkbox" name="selected_horses" value="{{ forloop.counter}}.{{ r.HorseName }}"
                           {% if r.HorseName in selected_horses %} checked {% endif %}
                           onclick="updateSelection(this)">
                    {{ forloop.counter }}. {% trans r.HorseName %}
                </label><br>
            {% endfor %}
            <br>
            <button type="submit">{% trans 'Submit' %}</button>
            <br>
        </form>

        </div>
      </div>
      <div id="id02" class="w3-modal">
        <div class="w3-modal-content w3-animate-top">
            <div class="w3-center">
                <span onclick="closeLoginFormModal()" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
            </div>
            <div class="w3-container w3-card-4 login-container w3-padding-64 w3-section w3-margin-top" style="max-width: 400px;">
                <h2 class="w3-center">{% trans 'Login' %}</h2>
                <form method="post" action="{% url 'login' %}" class="w3-container login-form">
                    <div class="w3-section">
                        {% csrf_token %}
                        <label class="w3-input w3-label w3-margin-bottom" for="id_username">{% trans 'Username' %}:</label>
                        <input class="w3-input w3-border" type="text" name="username" id="id_username" required>
                    </div>
                    <div class="w3-section">
                        <label class="w3-input w3-label w3-margin-bottom" for="id_password">{% trans 'Password' %}:</label>
                        <input class="w3-input w3-border" type="password" name="password" id="id_password" required>
                    </div>
                    <div class="w3-section">
                        <button type="submit" class="w3-button w3-block w3-green w3-section w3-padding">{% trans 'Login' %}</button>
                    </div>
                </form>
                <div class="w3-section">
                  <!-- Add a button for new user registration -->
                  <a href="{% url 'register' %}" class="w3-button w3-block w3-blue w3-section w3-padding">{% trans 'Register' %}</a>
              </div>
            </div>
        </div>

    </div>

    </div>
    
    </div>


    <!-- JavaScript code -->
    

    <script>
      // Get the current date and time
      var currentDatetime = new Date("{{ current_datetime | date:'Y-m-d\TH:i:s' }}");
      // Define the start and end date and time for the period
      var startDate = new Date("2024-09-11T19:05:00");
      var endDate = new Date("2025-12-25T23:59:59");
      
      // Disable the button if the current date and time fall within the specified period
      if (currentDatetime >= startDate && currentDatetime < endDate) {
    
          var myButton = document.getElementById("myButton");
          myButton.disabled = true;
          myButton.classList.add("disabled-button");
          document.getElementById("myButton").innerHTML = "X"; // Change the text
          document.getElementById("msg001").innerHTML = '<i class="fa fa-hand-o-left fa-lg" aria-hidden="true"></i>&nbsp;{% trans "Not Open Yet" %}'
      }
      </script>
      <script>
        // Function to handle login form submission
        function handleLoginFormSubmission() {
            // Code to handle form submission and login process
            // Upon successful login, close the login form modal and show the add tips form modal
            closeLoginFormModal();
            showAddTipsFormModal();
        }
    
        // Function to close the login form modal
        function closeLoginFormModal() {
            document.getElementById("id02").style.display = "none";
        }
    
        // Function to show the add tips form modal
        function showAddTipsFormModal() {
            document.getElementById("addTipsFormModal").style.display = "block";
        }
    
        // Function to close the add tips form modal
        function closeAddTipsFormModal() {
            document.getElementById("id01").style.display = "none";
        }
    </script>

<script type="text/javascript">
  var utag_data = {
  }
  </script>
  

  
      
  
{% endblock %}
