{% extends "master.html" %} {% block title %} Horse Racing Prediction By Machine Learning  and Users {% endblock %} 

{% load i18n %}
{% load static %}

{% block content %}


<script>
  function updateSelection(checkbox) {
      var selectedCheckboxes = document.querySelectorAll('input[name="selected_horses"]:checked');

      if (selectedCheckboxes.length > 3) {
          checkbox.checked = false; // Uncheck the current checkbox if more than 3 are selected
      }

      // Disable unchecked checkboxes if 3 are selected
      var uncheckedCheckboxes = document.querySelectorAll('input[name="selected_horses"]:not(:checked)');
      uncheckedCheckboxes.forEach(function (uncheckedCheckbox) {
          uncheckedCheckbox.disabled = selectedCheckboxes.length >= 3;
      });
  }
</script>

<div class="w3-container w3-padding-32"></div>
<div class="w3-margin ">
    <h2><img src="{% static 'MYFlag.png' %}" alt="Malaysia" style="width:4%"> {% trans "Current Race"  %} (Beta) </h2>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '1' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=1">1</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '2' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=2">2</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '3' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=3">3</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '4' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=4">4</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '5' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=5">5</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '6' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=6">6</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '7' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=7">7</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '8' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=8">8</a>
        <a class="w3-button w3-xlarge w3-circle {% if request.GET.id == '9' %}w3-red{% else %}w3-black{% endif %}" href="/racecard_my/?id=9">9</a>
 
<div class="w3-row">
  <div class="w3-col w3-padding-top-32 l6 s12">
    
    <table class="w3-table-all w3-card-4 w3-margin">
      <thead>
        <tr class="w3-light-blue">
          <th>No</th>
          <th>{% trans "Horse Name" %}</th>
          <th class="w3-hide-small">{% trans "Jockey" %}</th>
          <th>{% trans 'Vote' %}</th>
          <th  class="w3-hide-small">{% trans "Draw" %}</th>
        </tr>
      </thead>
      {% for i, r in current_race.iterrows %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{% trans r.horse_name %} </td>
        <td class="w3-hide-small">{% trans r.jockey %}</td>
        <td>
            ---
      </td>
        <td class="w3-hide-small">{{ r.bar }}</td>
      </tr>
      {% endfor %}
    </table>
   
  </div>
  <div class="w3-col w3-padding-top-32 l6 s12" >
    <div class="w3-margin">
  
    
    &nbsp &nbsp <i class="fa-solid fa-person fa-xl"></i>&nbsp  {% trans 'Human'%} &nbsp 
    {% for item in tips_qty_by_type %}
        {% if item.user__groups__name == 'MailList' %}
                <span class="w3-badge w3-green"> {{ item.num_users }} </span>
        {% endif %}
    {% endfor %}
          
                 |&nbsp
      <i class="fa-solid fa-robot fa-xl"></i>&nbsp {% trans 'Robot'%} &nbsp; 
      {% for item in tips_qty_by_type %}
      {% if item.user__groups__name != 'MailList' %}
      <span class="w3-badge w3-blue"> {{ item.num_users }}</span>
      {% endif %}
      {% endfor %}
    
  </div>
    <div class="w3-row-padding">
    
    {% for user_data in complete_tips_by_user %} <!-- Loop over the zipped data -->
      {% cycle 'w3-blue' 'w3-green' 'w3-yellow' 'w3-brown' 'w3-indigo' 'w3-lime' 'w3-amber' as color silent %}
          <div class="w3-col w3-card-4 w3-third w3-margin-left w3-margin-bottom l3 m5 s5 w3-left-align">
            
            <header class="w3-container {{color}}" >
              <h6>{{ user_data.user  }}
                {% if forloop.counter == 1 %}
                    <span class="w3-right"><i class="fa-solid fa-crown fa-rotate-by" style="color: #FFD43B; --fa-rotate-angle: 15deg;""></i></span>
                {% elif forloop.counter == 2 %}
                <span class="w3-right"><i class="fa-solid fa-crown fa-rotate-by" style="color: #f6f5f1e9; --fa-rotate-angle: 15deg;""></i></span>
                {% endif %}<br>
                {% for score in user_scores %}
                {% if score.user == user_data.user %}
                  {% if score.stars %}
                      {% for _ in score.stars %}
                      <i class="fa-solid fa-star fa-sm" style="color: #FFD43B;"></i>
                      {% endfor %}
                  {% else %}
                      -
                  {% endif %}
                {% endif %}
                {% endfor %}</h6>
              </header>
                  {% for user_tips in user_data.records %}
                          <p><span class="w3-badge">{{ user_tips.horse_no }}</span>&nbsp {% trans user_tips.horse_name %} {% if user_tips.hit == 1 %}
                            <span class="w3-badge w3-red w3-small">${{user_tips.dividend}}</span>
                          {% endif %}
                          </p>
                          <!-- Add more details as needed -->
                  {% endfor %}
                  <footer class="w3-container {{color}} w3-left-align">
                    <span class="w3-small">
                      <p class="w3-left-align">
                        {% trans 'Current' %}:
                        {% for last_perf in last_perf_by_user %}
                          {% if last_perf.user__username  == user_data.user.username %}
                            <span class ="w3-tooltip w3-red">{{ last_perf.hit_pst | floatformat:0 }}% 
                            <span class="w3-text">(<em>ðŸ’°${{ last_perf.total_dividend | floatformat:0 }}</em>)</span></span>
                          {% endif %}
                        {% endfor %}
                        <br>
                        {% trans 'Total' %}:
                        {% for score in user_scores %}
                            {% if score.user == user_data.user %}
                                {{ score.percentage | floatformat:0 }}%
                            {% endif %}
                        {% endfor %}
                        <span class = "w3-right">
                        {% if user_data.groups_name == "MailList" %}
                          <i class="fa-solid fa-person fa-xl "></i>
                        {% elif user_data.user.username == 'WePower' %}
                            <i class="fa-solid fa-users-gear fa-xl"></i>
                        {% else %}
                          <i class="fa-solid fa-robot"></i>
                        {% endif %} </span>
                      </p> 
                  </span>
                  </footer>
      </div>
      {% endfor %}
  
{% endblock %}
